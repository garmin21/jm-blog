---
title: ç”»ä¸­ç”» Document Picture-in-Picture API
createTime: 2025/01/20 10:40:23
permalink: /article/isri3d3z/
tags:
  - BOM
---

PiP çš„æ ¸å¿ƒæ–¹æ³•æ˜¯ window.documentPictureInPicture.requestWindowã€‚
å®ƒæ˜¯ä¸€ä¸ª å¼‚æ­¥æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„ window å¯¹è±¡ã€‚
PIP çª—å£å¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæ–°çš„ç½‘é¡µï¼Œä½†å®ƒå§‹ç»ˆæ‚¬æµ®åœ¨å±å¹•ä¸Šæ–¹ã€‚
å¯ä»¥ç›´æ¥ç‚¹å³ä¸Šè§’å…³é—­ PIP çª—å£ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨ä»£ç ä¸­å®ç°å…³é—­ï¼Œç›´æ¥è°ƒç”¨ window ä¸Šçš„ api å°±å¯ä»¥äº†
`window.documentPictureInPicture.window.close();`

:::normal-demo

```css
#pipContent {
  width: 600px;
  height: 300px;
  background: pink;
  font-size: 20px;
}
```

```html
<div id="container">
  <div id="pipContent">è¿™æ˜¯ä¸€ä¸ªå°†è¦æ”¾å…¥ç”»ä¸­ç”»çš„ div å…ƒç´ ï¼</div>
  <button id="clickBtn">åˆ‡æ¢ç”»ä¸­ç”»</button>
</div>
```

:::

```js
// æ£€æŸ¥æ˜¯å¦æ”¯æŒ PiP åŠŸèƒ½
if ('documentPictureInPicture' in window) {
  console.log('ğŸš€ æµè§ˆå™¨æ”¯æŒ PiP åŠŸèƒ½ï¼');
} else {
  console.warn('âš ï¸ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ PiP åŠŸèƒ½ï¼Œæ›´æ–°æµè§ˆå™¨æˆ–è€…æ¢å°ç”µè„‘å§ï¼');
}
// è¯·æ±‚ PiP çª—å£
document
  .getElementById('clickBtn')
  .addEventListener('click', async function () {
    const pipContent = document.getElementById('pipContent');
    const pipWindow = await window.documentPictureInPicture.requestWindow({
      width: 200,
      // è®¾ç½®çª—å£çš„å®½åº¦
      height: 300,
      // è®¾ç½®çª—å£çš„é«˜åº¦
    });
    // å°†åŸå§‹å…ƒç´ å…‹éš†å¹¶æ·»åŠ åˆ° PiP çª—å£ä¸­
    pipWindow.document.body.style.overflow = `hidden`;
    pipWindow.document.body.appendChild(pipContent.cloneNode(true));
    // è®¾ç½® PiP æ ·å¼åŒæ­¥
    [...document.styleSheets].forEach((styleSheet) => {
      try {
        const cssRules = [...styleSheet.cssRules]
          .map((rule) => rule.cssText)
          .join('');
        const style = document.createElement('style');
        style.textContent = cssRules;
        pipWindow.document.head.appendChild(style);
      } catch (e) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = styleSheet.type;
        link.media = styleSheet.media;
        link.href = styleSheet.href ?? '';
        pipWindow.document.head.appendChild(link);
      }
    });
    // ç›‘å¬è¿›å…¥å’Œé€€å‡º PiP æ¨¡å¼çš„äº‹ä»¶
    pipWindow.addEventListener('pagehide', (event) => {
      console.log('å·²é€€å‡º PIP çª—å£');
    });
    pipWindow.addEventListener('focus', () => {
      console.log('PiP çª—å£è¿›å…¥äº†ç„¦ç‚¹çŠ¶æ€');
    });
    pipWindow.addEventListener('blur', () => {
      console.log('PiP çª—å£å¤±å»äº†ç„¦ç‚¹');
    });
  });
// å…³é—­ PiP çª—å£
// pipWindow.close();  // å¯ä»¥æ‰‹åŠ¨è°ƒç”¨å…³é—­çª—å£
```
